<!-- 過去のカウンセリング日記詳細（日次グラフ） -->
{% extends "base.html" %}

{% load static%}

{% block title %}日記詳細{% endblock %}

{% block header %}
<header>
    <div class="header__button">
        <div class="header__back__img">
            {% comment %} calendar_month.htmlまたはcalendar_week.htmlに遷移させてください {% endcomment %}
            <a href="">
                <svg width="9" height="16" viewBox="0 0 9 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.292893 8.70711C-0.097631 8.31658 -0.097631 7.68342 0.292893 7.29289L6.65685 0.928932C7.04738 0.538408 7.68054 0.538408 8.07107 0.928932C8.46159 1.31946 8.46159 1.95262 8.07107 2.34315L2.41421 8L8.07107 13.6569C8.46159 14.0474 8.46159 14.6805 8.07107 15.0711C7.68054 15.4616 7.04738 15.4616 6.65685 15.0711L0.292893 8.70711ZM2 9L1 9L1 7L2 7L2 9Z" fill="white"/>
                </svg>
                戻る</a>
        </div>
    </div>
    <!-- カレンダーから選択した日付・天気を表示してください。 -->
    <h1 class="date">--/--(-)</h1>
    <div class="header__weather">
        <img class="weatherImg">
        <span class="tempMax">-℃</span>
    </div>
</header>
{% endblock %}

{% block content %}
<main class="ground ground--blue"><!-- 追加した要素 -->
    <div class="scroll--content">

        <!-- タブ -->
        {% url 'diary:record_counseling' as record_counseling_url %}
        {% url 'diary:record_counseling_graph' as record_counseling_graph_url %}
        <div class="tab__button a--tab">
            <div class="a--tab--left {% if request.path == record_counseling_url %}active{% endif %}">
                <a href="{{ record_counseling_url }}">日記詳細画面</a>
            </div>
            <div class="a--tab--right {% if request.path == record_diary_graph_url %}active{% endif %}">
                <a href="{{ record_diary_graph_url }}">グラフ</a>
            </div>
        </div>

        <!-- グラフの表示 -->
        <script src="{% static 'js/chart.min.js' %}"></script>

        <div id="circle__graph">
            <div class="circle__graph__img">
                <img src="{% static 'diary/assets/circle_graph.svg' %}" alt="感情グラフ">感情の合計</img>
                {% comment %} グラフを表示 {% endcomment %}
                <div style="position: relative;">
                    <canvas id="myPieChart" width="400" height="200"></canvas>
                    <div id="popup" style="position: absolute; display: none; background-color: rgba(255, 255, 255, 0.7); border: 1px solid #000; padding: 10px;"></div>
                </div>
            </div>
        </div>

        <!-- ネココのカウンセリングコメント -->
        <div class="content__today-diary__counseling-comment">
            <p>
                {{ カウンセリングのコメントを表示させてください }}
            </p>
        </div>
        <!-- ネコココメントの画像 -->
        <div class="content__today-diary__comment__img">
            <img src="{% static'diary/assets/counselor_neko.svg' %}" alt="カウンセラーネココの画像">
        </div>
        </form>

    </div>
</main>

{% endblock %}

{% block javascripts %}
<script>
var data = {{ data|safe }};
var canvas = document.getElementById('myPieChart');

var ctx = canvas.getContext('2d');
var myPieChart = new Chart(ctx, {
    type: 'pie',
    data: {
        labels: data.labels,
        datasets: [{
            data: data.values,
            backgroundColor: ['red', 'blue', 'green', 'yellow']  // カラーコードを指定
        }]
    }
});

// 円グラフのクリックイベント処理
canvas.onclick = function(evt) {
    var activePoint = myPieChart.getElementsAtEvent(evt)[0];
    if (activePoint) {
        // クリックした項目に関連付けられた詳細情報を取得
        var itemIndex = activePoint._index;
        var itemLabel = data.labels[itemIndex];
        var itemValue = data.values[itemIndex];

        // クリック位置に詳細情報を表示
        var popup = document.getElementById('popup');
        popup.style.display = 'block';
        popup.style.left = (evt.clientX - canvas.getBoundingClientRect().left) + 'px';
        popup.style.top = (evt.clientY - canvas.getBoundingClientRect().top) + 'px';
        popup.innerHTML = `<p>項目: ${itemLabel}</p><p>値: ${itemValue}</p>`;

        // クリックした項目の詳細情報を非表示にするために、別の場所をクリックした際にポップアップを非表示にするコードを追加
        document.body.onclick = function() {
            popup.style.display = 'none';
        };
    }
};

</script>
{% endblock %}