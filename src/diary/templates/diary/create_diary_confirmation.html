<!-- 日記内容確認画面 -->
{% extends "base_diary.html" %}

{% load static %}

{% block title %}日記内容確認{% endblock %}

{% block css %}
<!-- ページ固有のCSSを読み込み -->
<link rel="stylesheet" href="{% static 'diary/css/home-page.css' %}">
{% endblock %}

{% block header %}
<header>
    <div class="header__button">
        <div class="header__back__img">
            {% comment %} create_diary.htmlに遷移 {% endcomment %}
            <a href="#" id="header__back__btn" onclick="history.back()">
                <svg width="9" height="16" viewBox="0 0 9 16" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M0.292893 8.70711C-0.097631 8.31658 -0.097631 7.68342 0.292893 7.29289L6.65685 0.928932C7.04738 0.538408 7.68054 0.538408 8.07107 0.928932C8.46159 1.31946 8.46159 1.95262 8.07107 2.34315L2.41421 8L8.07107 13.6569C8.46159 14.0474 8.46159 14.6805 8.07107 15.0711C7.68054 15.4616 7.04738 15.4616 6.65685 15.0711L0.292893 8.70711ZM2 9L1 9L1 7L2 7L2 9Z" fill="white"/>
                </svg>
                戻る</a>
        </div>
    </div>

    <h1 class="date">--/--(-)</h1>
    <div class="header__weather">
        <img class="weatherImg">
        <span class="tempMax">-℃</span>
    </div>
</header>
{% endblock %}

{% block content %}
<main class="ground ground--blue"><!-- 追加した要素 -->
    <div class="scroll--content">

        <!-- 入力されたテキストの表示 -->
        <div class="content__form-group">

                {% csrf_token %}
                <div class="content__today-diary__text">
                    <p>{{ saved_diary.content }}</p>

                    <div class="content__today-diary__img">
                        {% if saved_diary.photo1 %}
                            <img src="{{ saved_diary.photo1.url }}" alt="Diary Photo1" class="content__today-diary__item">
                        {% endif %}
                        {% if saved_diary.photo2 %}
                            <img src="{{ saved_diary.photo2.url }}" alt="Diary Photo2" class="content__today-diary__item">
                        {% endif %}
                        {% if saved_diary.photo3 %}
                            <img src="{{ saved_diary.photo3.url }}" alt="Diary Photo3" class="content__today-diary__item">
                        {% endif %}
                        {% if saved_diary.photo4 %}
                            <img src="{{ saved_diary.photo4.url }}" alt="Diary Photo4" class="content__today-diary__item">
                        {% endif %}
                    </div>
                </div>

                <!-- ネコココメント -->
                <div class="content__diary__comment">
                    <p>{{ saved_diary.ai_comment }}</p>
                </div>
                <!-- ネココの画像 -->
                <div class="content__diary__comment__img">
                    <img src="{% static 'diary/assets/neko_comment.svg' %}" alt="ネココの画像">
                </div>

                <div class="btn--blue">
                    <a href="{% url 'diary:positive_conversion' saved_diary.pk %}" class="button-link">ポジティブ変換する</a>
                    {% comment %} <button type="submit" id="submit-button" onclick="showLoadingScreenAndRedirect1('{% url 'diary:positive_conversion' %}')">日記をポジティブに変換</button> {% endcomment %}
                </div>
                <div class="btn--white">
                    <a href="{% url 'diary:today_diary_detail' saved_diary.pk %}" class="button-link">ポジティブ変換しない</a>
                </div>

        </div><!-- content__form-group -->

        <!-- ロード画面のコンテンツ -->
        <div id="loader" style="display: none;">
            <div class="load__img">
                <img src="{% static 'diary/assets/tea_neko.svg' %}" alt="ロード画面neko">
            </div>
            <div class="load__text">
                <p style="font-size: 24px; color: #333;">読み込み中...</p>
            </div>
        </div>


        <!-- ポップアップ要素 -->
        {% if 特定の条件でカウンセリング催促ポップアップを表示させる %}
        <div class="popup" id="first-popup">
            <div class="popup__text">
                <p>ネガティブが続いているにゃ。<br>ネココのカウンセリングを受けるにゃ。</p>
            </div>
            <div class="popup__img">
                <img src="{% static 'diary/assets/counseling_request.svg' %}" alt="カウンセリングを薦める猫の画像">
            </div>
            <div class="button">
                <button type="button" onclick="location.href='{% url 'today_counseling.htmlに遷移させてください' %}'">ネココのアドバイスを受ける</button>
            </div>
            <div class="gray__button">
                <button class="close-button" onclick="closePopup('first-popup')"><img src="{% static 'diary/assets/close.svg' %}" alt="アイコン">キャンセル</button>
            </div>
        </div>

        <div class="popup" id="second-popup">
            <div class="popup__text">
                <p>キャンセルするとカウンセリングを<br>
                    受けることができなくなります。<br>
                    キャンセルしますか？</p>
            </div>
            <div class="popup__img">
                <img src="{% static 'diary/assets/counseling_request.svg' %}" alt="カウンセリングを薦める猫の画像">
            </div>
            <div class="button">
                <button type="button" onclick="location.href='{% url 'today_counseling.htmlに遷移させてください' %}'">ネココのアドバイスを受ける</button>
            </div>
            <div class="gray__button">
                <button class="close-button" onclick="closePopup('second-popup')"><img src="{% static 'diary/assets/close.svg' %}" alt="アイコン">キャンセル</button>
            </div>
        </div>
        {% endif %}
    
    </div><!-- scroll content -->
</main>

{% endblock %}

{% block js %}
<script>
    // 戻るボタンを押したときの処理
    document.getElementById("header__back__btn").addEventListener("click", function() {
        history.back();
    });

    // カウンセリング催促ポップアップの表示
    $(function(){
        $('.popup').fadeIn();
    });

    $(document).ready(function() {
        // ポップアップを下からスライドして表示
        $('.popup').slideDown();

        // キャンセルボタンをクリックした時の処理
        //$('.cancel-button').click(function() {
            //$('.popup').slideUp();
        //});
    });

    function closePopup(id) {
        document.getElementById(id).classList.remove("show");
    }

      // 保存ボタンをクリックしたときに最初のポップアップを表示する
    document.getElementById("save-button").addEventListener("click", function() {
    document.getElementById("first-popup").classList.add("show");
    });

      // 最初のポップアップのキャンセルボタンをクリックしたときに2番目のポップアップを表示する
    document.getElementById("first-popup").querySelector(".close-button").addEventListener("click", function() {
    document.getElementById("second-popup").classList.add("show");
    });

      // 2番目のポップアップのキャンセルボタンをクリックしたときにポップアップを閉じる
    document.getElementById("second-popup").querySelector(".close-button").addEventListener("click", function() {
        document.getElementById("first-popup").classList.remove("show");
        document.getElementById("second-popup").classList.remove("show");
    });

// ロード画面呼び出し
    function showLoadingScreen() {
        document.getElementById('loader').style.display = 'block';
    }

    function hideLoadingScreen() {
        document.getElementById('loader').style.display = 'none';
    }

    function showLoadingScreenAndRedirect() {
        showLoadingScreen(); // ロード画面を表示

    function showLoadingScreenAndRedirect1() {
        var redirectUrl = '/diary:positive_conversion';  // ボタン1用のリダイレクト先URL
        window.location.href = redirectUrl;  // リダイレクト
    }

    function showLoadingScreenAndRedirect2() {
        var redirectUrl = '/diary:today_diary_detail';  // ボタン2用のリダイレクト先URL
        window.location.href = redirectUrl;  // リダイレクト
    }

            // 待ち時間後にリダイレクト
            setTimeout(function() {
                hideLoadingScreen(); // ロード画面を非表示
                window.location.href = redirectUrl;
            }, 5000); // 5秒後にリダイレクト
        }

</script>
{% endblock %}

    {% comment %} document.getElementById("text-form").addEventListener("submit", function (e) {
        e.preventDefault();

        var userText = document.getElementById("user-text").value;

        // 特定の条件が満たされた場合にポップアップを表示
        if (userText.includes("特定のワード")) {
            // ポップアップを表示
            document.getElementById("popup").style.display = "block";
        } else {
            // 特定の条件に該当しない場合はフォームを通常の方法で送信
            this.submit();
        }
    }); {% endcomment %}
